name: Create and Push Multi-Architecture Manifest

on:
  push:
    branches:
      - branchHTTPserver

jobs:
  manifest:
    runs-on: ubuntu-latest

    steps:
    - name: Log in to Docker Hub
      uses: docker/login-action@v2
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}

    - name: Create and push Docker manifest
      run: |
        docker manifest create nazarboyko/http-server:latest \
          --amend nazarboyko/http-server:latest-amd64 \
          --amend nazarboyko/http-server:latest-arm64

        docker manifest push nazarboyko/http-server:latest
